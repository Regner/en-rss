

box: python:2.7

# services:
#     - id: google/cloud-sdk
#       tag: latest
#       cmd: gcloud beta emulators datastore start

build:
  steps:
    - virtualenv:
        name: setup virtual environment
        install_wheel: false

    - pip-install

    - script:
        name: echo python information
        code: |
          echo "python version $(python --version) running"
          echo "pip version $(pip --version) running"

deploy:
  box: google/cloud-sdk
  steps:
    - script:
        name: gcr.io authentication
        code: |
          echo $CLIENT_SECRET | base64 --decode > ${HOME}/client-secret.json
          gcloud --quiet components update app
          gcloud auth activate-service-account --key-file ${HOME}/client-secret.json
          gcloud config set project $GCLOUD_PROJECT
          gcloud docker --authorize-only
    
    - internal/docker-push:
        repository: eu.gcr.io/eve-notifications/en-rss
        registry: https://eu.gcr.io