machine:
  services:
    - docker
  environment:
    GCLOUD_PROJECT: "eve-notifications"
    DOCKER_IMAGE_NAME: "eu.gcr.io/eve-notifications/en-rss"
    GCLOUD_ZONE: "europe-west1-d"

dependencies:
  pre:
    - ./ensure-kubernetes-installed.sh
    - ./setup-gcloud.sh

deployment:
  gcr.io:
    branch: master
    commands:
      - ./docker-push.sh
      - export CLUSTER_NAME="eve-notifications"
      - export RC_FILE="en-rss-rc-dev.yml.template"
      - export RC_NAME="en-rss-dev"
      - ./deploy.sh

  release:
    tag: /release-.*/
    commands:
      - export CLUSTER_NAME="eve-notifications"
      - export RC_FILE="en-rss-rc-release.yml.template"
      - export RC_NAME="en-rss-release"
      - ./deploy.sh
